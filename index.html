<!DOCTYPE html>
<meta charset="UTF-8"> 

<html>
<script src="javascripts/jquery-2.2.0.min.js"></script>
<script type="text/javascript">
// $(document).ready(function(){
//     $('[expanding="True"]').click(function(){
//     	$('[state="hidden"]').hide();
//     	showTarget = "#"+$(this).attr("expandName");
//       $(showTarget).show(500);
//       // $(hideTarget).animate({width: 'toggle'});
//     });
// });
</script>
<head>
<link type="text/css" rel="stylesheet" href="stylesheets/jquery.qtip.css" />
<style type="text/css">
	html, body {
		background-color:#ffffff;
		margin:0 0 0 0;
		height:100%;
	}
	input{
		border:none;
		padding:0px;
	}
	input.base{
		width:50px;
		height:50px;
		text-align: center;
	}
	input.bltable{
		width:30px;
		text-align: center;
	}
	input.tooltip{
		width:30px;
		height:30px;
		padding:0px;
		border:none;
		text-align: center;
		font-weight: bold;
	}
	div.sidebar{
		width: 80px;
		height: 300vh;
		background: #F00;
	  float:left;
		text-align:center;
	}
	div.attribute{
		width: 50px;
		height: 50px;
		display: table-cell;
		vertical-align: middle;
		text-align:center;
	}
	div.calculation{
		/*width: 300px;*/
		/*height: 50px;*/
		/*background: #F00;*/
		/*display: table-cell;*/
		vertical-align: middle;
		text-align:center;
	}
	div.attributeEx{
		width: 50px;
		height: 50px;
		display: table-cell;
		vertical-align: middle;
		text-align:center;
	}
	table, th, td {
    border: 0px solid black;
	}
</style>
</head>
<body>

<form id="frm1">
		<div class="sidebar">
		Hello
		</div>
		<div style="display:inline-block">
			<div>
			<div class="attribute"><a>ST</a></div>
			<div class="attribute"><input class="base" type="text" name="stValue" value="10"></div>
			<div class="attribute"><input class="base" type="text" name="stCost" value="0" readonly></div>
			<div style="display: table-cell;" expanding="True">
			<div class="attribute"><a>HP</a></div>
			<div class="attribute"><input class="base" type="text" name="hpValue" value="10" readonly></div>
			<div class="attribute"><input class="base" type="text" name="hpCost" value="0" readonly></div>
			</div>
			<div class="calculation" id="hpExpand" state="hidden">HP=ST+<input class="tooltip" type="text" name="hpOffValue" value="0"></div>
			</div>
			<div>
			<div class="attribute"><a>DX</a></div>
			<div class="attribute"><input class="base" type="text" name="dxValue" value="10"></div>
			<div class="attribute"><input class="base" type="text" name="dxCost" value="0"></div>
			<div style="display: table-cell;" expanding="True">
			<div class="attribute"><a>Per</a></div>
			<div class="attribute"><input class="base" type="text" name="perValue" value="10"></div>
			<div class="attribute"><input class="base" type="text" name="perCost" value="0"></div>
			</div>
			<div class="calculation" id="perExpand" state="hidden">Per=IQ+<input class="tooltip" type="text" name="perOffValue" value="0"></div>
			</div>
			<div>
			<div class="attribute"><a>IQ</a></div>
			<div class="attribute"><input class="base" type="text" name="iqValue" value="10"></div>
			<div class="attribute"><input class="base" type="text" name="iqCost" value="0"></div>
			<div style="display: table-cell;" expanding="True">
			<div class="attribute"><a>Will</a></div>
			<div class="attribute"><input class="base" type="text" name="willValue" value="10"></div>
			<div class="attribute"><input class="base" type="text" name="willCost" value="0"></div>
			</div>
			<div class="calculation" id="willExpand" state="hidden">Will=IQ+<input class="tooltip" type="text" name="willOffValue" value="0"></div>
			</div>
			<div>
			<div class="attribute"><a>HT</a></div>
			<div class="attribute"><input class="base" type="text" name="htValue" value="10"></div>
			<div class="attribute"><input class="base" type="text" name="htCost" value="0"></div>
			<div style="display: table-cell;" expanding="True">
			<div class="attribute"><a>FP</a></div>
			<div class="attribute"><input class="base" type="text" name="fpValue" value="10"></div>
			<div class="attribute"><input class="base" type="text" name="fpCost" value="0"></div>
			</div>
			<div class="calculation" id="fpExpand" state="hidden">FP=HT+<input class="tooltip" type="text" name="fpOffValue"	value="0"></div>
			</div>
			<div>
			<div style="display: table-cell;" expanding="True">
			<div class="attribute"><a>BS</a></div>
			<div class="attribute"><input class="base" type="text" name="bsValue" value="10"></div>
			<div class="attribute"><input class="base" type="text" name="bsCost" value="0"></div>
			</div>
			<div class="calculation" state="hidden">BS=BS+<input class="tooltip" type="text" name="bsOffValue"	value="0"></div>
			<div style="display: table-cell;" expanding="True">
			<div class="attribute"><a>BM</a></div>
			<div class="attribute"><input class="base" type="text" name="bmValue" value="10"></div>
			<div class="attribute"><input class="base" type="text" name="bmCost" value="0"></div>
			</div>
			<div class="calculation" state="hidden">BM=BM+<input class="tooltip" type="text" name="bmOffValue"	value="0"></div>
			</div>
			<div>
			<div class="attribute"><a>THR</a></div>
			<div class="attribute"><input class="base" type="text" name="thrValue" value="-"></div>
			<div class="attribute"></div>
			<div class="attribute"><a>SWI</a></div>
			<div class="attribute"><input class="base" type="text" name="swiValue" value="-"></div>
			<div class="attribute"></div>
			</div>
			<div>
			<div class="attribute"><a>BL</a></div>
			<div class="attribute"><input class="base" type="text" name="blValue" value="-"></div>
			</div>
		</div>

		<div>
			<table>
			<tr><td>None (0) = BL</td>			<td><input class="bltable" name="bl0" value="0"></td>	<td>BM × 1</td>		<td><input class="bltable" name="bm0" value="0"></td>	<td>Dodge</td>		<td><input class="bltable" name="do0" value="0"></td></tr>
			<tr><td>Light (1) = 2 × BL</td>		<td><input class="bltable" name="bl1" value="0"></td>	<td>BM × 0.8</td>	<td><input class="bltable" name="bm1" value="0"></td>	<td>Dodge -1</td>	<td><input class="bltable" name="do1" value="0"></td></tr>
			<tr><td>Medium (2) = 3 × BL</td>	<td><input class="bltable" name="bl2" value="0"></td>	<td>BM × 0.6</td>	<td><input class="bltable" name="bm2" value="0"></td>	<td>Dodge -2</td>	<td><input class="bltable" name="do2" value="0"></td></tr>
			<tr><td>Heavy (3) = 6 × BL</td>		<td><input class="bltable" name="bl3" value="0"></td>	<td>BM × 0.4</td>	<td><input class="bltable" name="bm3" value="0"></td>	<td>Dodge -3</td>	<td><input class="bltable" name="do3" value="0"></td></tr>
			<tr><td>X-Heavy (4) = 10 × BL</td>	<td><input class="bltable" name="bl4" value="0"></td>	<td>BM × 0.2</td>	<td><input class="bltable" name="bm4" value="0"></td>	<td>Dodge -4</td>	<td><input class="bltable" name="do4" value="0"></td></tr>
			</table>
		</div>
		<div>
			<table>
			<tr><td>Languages</td><td>Spoken</td><td>Written</td><td></td></tr>
			<tr index="0"><td><input object="lan" name="Name" value="-"></td><td><input object="lan" name="Spoken" value="-"></td><td><input object="lan" name="Wri" value="-"></td><td><input object="lan" name="Cost" value="-"></td><td> <button type="button" onclick="lanTable($(this))">Click Me!</button></td></tr>
			</table>
		</div>
<!-- <button type="button" onclick="aFunction()">Click Me!</button> 	 -->
</form>
<script src="javascripts/jquery.qtip.js"></script>
</body>
<script src="data/strChart.js"></script>
<script>
//JSON Convert
var a = {};

$('input').each(addAttr);
$('input').change(addAttr);
$.each(a, returnAttr);

function checkAttr(){
	$('input').each(addAttr);
}

function returnAttr(k, v){
	// console.log(k);
	$('[name="'+k+'"]').val(v);
	// console.log(v);
}

function addAttr(){
// window.alert("CHANGE!");
var inputName = $(this).attr('name');
var objectName = $(this).attr('object');
var inputValue = this.value;

if(objectName == undefined) {
	a[inputName] = inputValue;	
} else {
	var index = $(this).parents('[index]').attr('index');
	if(a[objectName]== undefined){
		a[objectName]={};
	}
	if(a[objectName][index]== undefined){
		a[objectName][index]={};
	}
	a[objectName][index][inputName] = inputValue;
}

calculateJson();
// console.log("change: "+ inputName +" | "+ inputValue);
}

// End of JSON Convert

$('[expanding="True"]').each(function() {
    $(this).qtip({
        content: {text: $(this).next('div.calculation')},
        show: {solo: true,effect: function() {$(this).fadeTo(500, 1); }},
        hide: {event: 'click unfocus', inactive: 3000,effect: function() {$(this).fadeTo(500, 0); }},
        position: {my: 'left center', at: 'center right',viewport: $(window)}});
});

$('[state="hidden"]').hide();

function calculateJson() {
	a.stCost =		((a.stValue)-10)*10;
	a.dxCost =		((a.dxValue)-10)*20;
	a.iqCost =		((a.iqValue)-10)*20;
	a.htCost =		((a.htValue)-10)*10;
	a.hpValue =		parseInt(a.hpOffValue)+parseInt(a.stValue);
	a.perValue =	parseInt(a.perOffValue)+parseInt(a.iqValue);
	a.willValue =	parseInt(a.willOffValue)+parseInt(a.iqValue);
	a.fpValue =		parseInt(a.fpOffValue)+parseInt(a.htValue);
	a.bsValue =		parseFloat(a.bsOffValue)+((parseInt(a.dxValue)+parseInt(a.htValue))/4);
	a.bmValue =		parseFloat(a.bmOffValue)+Math.floor(((parseInt(a.dxValue)+parseInt(a.htValue))/4));
	a.blValue =		roundToOne(((a.stValue*a.stValue)/5)*0.454);
	a.hpCost =		a.hpOffValue*2;
	a.perCost =		a.perOffValue*5;
	a.willCost =	a.willOffValue*5;
	a.fpCost =		a.fpOffValue*3;
	a.bsCost =		a.bsOffValue*20;
	a.bmCost =		a.bmOffValue*5;
	stLookup =		"st"+a.stValue;
	a.thrValue =	strChart[stLookup].thr;
	a.swiValue =	strChart[stLookup].swi;
	a.dodgeValue =	Math.floor(((parseInt(a.dxValue)+parseInt(a.htValue))/4))+3;
	a.bl0 =			a.stValue;
	a.bl1 =			a.stValue*2;
	a.bl2 =			a.stValue*3;
	a.bl3 =			a.stValue*6;
	a.bl4 =			a.stValue*10;
	a.bm0 =			Math.floor(a.bmValue*1);
	a.bm1 =			Math.floor(a.bmValue*0.8);
	a.bm2 =			Math.floor(a.bmValue*0.6);
	a.bm3 =			Math.floor(a.bmValue*0.4);
	a.bm4 =			Math.floor(a.bmValue*0.2);
	a.do0 =			a.dodgeValue-0;
	a.do1 =			a.dodgeValue-1;
	a.do2 =			a.dodgeValue-2;
	a.do3 =			a.dodgeValue-3;
	a.do4 =			a.dodgeValue-4;
	$.each(a, returnAttr);
}

function lanTable(buttonObject){
	var parent = $(buttonObject).parents('[index]');
	console.log(parent);
	var parentIndex= parseInt($(parent).attr('index'))+parseInt(1);
	console.log(parentIndex);
	$(parent).after('<tr index="'+parentIndex+'"><td><input object="lan" name="Name" value="-"></td><td><input object="lan" name="Spoken" value="-"></td><td><input object="lan" name="Wri" value="-"></td><td><input object="lan" name="Cost" value="-"></td><td> <button type="button" onclick="lanTable($(this))">Click Me!</button></td></tr>');
	$(buttonObject).hide();
	checkAttr()
	console.log(a);
}

function calculateForm() {
	// var x = document.getElementById("frm1");
	// $('[name="stCost"]').val("["+(parseInt($('[name="stValue"]').val())-10)*10 + "]");
	// $('[name="dxCost"]').val("["+(parseInt($('[name="dxValue"]').val())-10)*20 + "]");
	// $('[name="iqCost"]').val("["+(parseInt($('[name="iqValue"]').val())-10)*20 + "]");
	// $('[name="htCost"]').val("["+(parseInt($('[name="htValue"]').val())-10)*10 + "]");
	// $('[name="hpValue"]').val((parseInt($('[name="hpOffValue"]').val())+parseInt($('[name="stValue"]').val())));
	// $('[name="hpCost"]').val("["+(parseInt($('[name="hpOffValue"]').val()))*2+"]");
	// $('[name="perValue"]').val((parseInt($('[name="perOffValue"]').val())+parseInt($('[name="iqValue"]').val())));
	// $('[name="perCost"]').val("["+(parseInt($('[name="perOffValue"]').val()))*5+"]");
	// $('[name="willValue"]').val((parseInt($('[name="willOffValue"]').val())+parseInt($('[name="iqValue"]').val())));
	// $('[name="willCost"]').val("["+(parseInt($('[name="willOffValue"]').val()))*5+"]");
	// $('[name="fpValue"]').val((parseInt($('[name="fpOffValue"]').val())+parseInt($('[name="htValue"]').val())));
	// $('[name="fpCost"]').val("["+(parseInt($('[name="fpOffValue"]').val()))*3+"]");
	// $('[name="bsValue"]').val((parseFloat($('[name="bsOffValue"]').val())+((parseFloat($('[name="htValue"]').val())+parseFloat($('[name="dxValue"]').val()))/4)));
	// $('[name="bsCost"]').val("["+(parseFloat($('[name="bsOffValue"]').val()))*20+"]");
	

	// x.stCost.value = "["+(parseInt(x.stValue.value)-10)*10 + "]";
	// x.dxCost.value = "["+(parseInt(x.dxValue.value)-10)*20 + "]";
	// x.iqCost.value = "["+(parseInt(x.iqValue.value)-10)*20 + "]";
	// x.htCost.value = "["+(parseInt(x.htValue.value)-10)*10 + "]";
	// x.hpValue.value = (parseInt(x.hpOffValue.value)+parseInt(x.stValue.value));
	// x.hpCost.value = "["+(parseInt(x.hpOffValue.value))*2+"]";
	// x.perValue.value = (parseInt(x.perOffValue.value)+parseInt(x.iqValue.value));
	// x.perCost.value = "["+(parseInt(x.perOffValue.value))*5+"]";
	// x.willValue.value = (parseInt(x.willOffValue.value)+parseInt(x.iqValue.value));
	// x.willCost.value = "["+(parseInt(x.willOffValue.value))*5+"]";
	// x.fpValue.value = (parseInt(x.fpOffValue.value)+parseInt(x.htValue.value));
	// x.fpCost.value = "["+(parseInt(x.fpOffValue.value))*3+"]";
	// x.bsValue.value = (parseFloat(x.bsOffValue.value)+((parseFloat(x.htValue.value)+parseFloat(x.dxValue.value))/4));
	// x.bsCost.value = "["+(parseFloat(x.bsOffValue.value))*20+"]";
}
function parseValue(o) {
	c = "[name='"+o.attr("target")+"']"
	var targetObject = $(c);
	var valueChange = o.val();
	targetObject.val(valueChange);

}
function roundToOne(num) {    
    return +(Math.round(num + "e+1")  + "e-1");
}
console.log(a);
</script>
</html>
